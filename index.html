<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>黑客帝国 - 数字雨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            overflow: hidden;
            font-family: "Courier New", monospace;
            height: 100vh;
            width: 100vw;
        }

        #input-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #text-input, #background-text-input {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ff41;
            color: #00ff41;
            font-size: 18px;
            padding: 10px 20px;
            width: 400px;
            font-family: "Courier New", monospace;
            text-shadow: 0 0 5px #00ff41;
            outline: none;
        }

        #text-input::placeholder, #background-text-input::placeholder {
            color: #00ff4166;
        }

        #matrix {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .column {
            position: absolute;
            top: -100%;
            color: #00ff41;
            font-size: 24px;
            text-shadow: 0 0 5px #00ff41;
            line-height: 1.4;
            animation: fall linear infinite;
            opacity: 0;
        }

        .user-text {
            position: absolute;
            top: -100%;
            color: #ffffff;
            font-size: 32px;
            text-shadow: 0 0 10px #ffffff, 0 0 20px #00ff41, 0 0 30px #00ff41;
            line-height: 1.4;
            white-space: nowrap;
            animation: fall linear;
            opacity: 0;
            font-weight: bold;
        }

        @keyframes fall {
            0% {
                top: -100%;
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                top: 100%;
                opacity: 0;
            }
        }

        .column .char {
            display: block;
        }
    </style>
</head>
<body>
    <div id="input-container">
        <input type="text" id="background-text-input" placeholder="修改背景文字（默认：我爱琪娃子）" value="我爱琪娃子">
        <input type="text" id="text-input" placeholder="输入文字，按回车让它落下...">
    </div>
    <div id="matrix"></div>

    <script>
        const matrix = document.getElementById("matrix");
        const textInput = document.getElementById("text-input");
        const backgroundTextInput = document.getElementById("background-text-input");
        let backgroundText = "我爱琪娃子";
        const columns = [];
        const columnSpacing = 80; // 增加列间距，让密度更稀疏
        let columnCount = Math.floor(window.innerWidth / columnSpacing);

        function getBackgroundText() {
            const text = backgroundTextInput.value.trim();
            return text || "我爱琪娃子";
        }

        function createColumn(index) {
            const column = document.createElement("div");
            column.className = "column";
            column.style.left = (index * columnSpacing) + "px";
            
            const currentBackgroundText = getBackgroundText();
            
            // 计算需要多少个单元来填满屏幕
            const charHeight = 24 * 1.4;
            const unitsNeeded = Math.ceil(window.innerHeight / charHeight) + 2;
            
            // 构建文本：每个字符单独一行，中间有空行（空格）
            for (let i = 0; i < unitsNeeded; i++) {
                // 添加背景文字的每个字符，每个字符单独一行
                for (let j = 0; j < currentBackgroundText.length; j++) {
                    const char = document.createElement("span");
                    char.className = "char";
                    char.textContent = currentBackgroundText[j];
                    column.appendChild(char);
                }
                // 添加几个空行（使用&nbsp;确保可见）
                for (let k = 0; k < 3; k++) {
                    const space = document.createElement("span");
                    space.className = "char";
                    space.innerHTML = "&nbsp;";
                    column.appendChild(space);
                }
            }
            
            matrix.appendChild(column);
            columns.push(column);
            
            const duration = Math.random() * 8000 + 6000;
            const delay = Math.random() * 5000;
            column.style.animationDuration = duration + "ms";
            column.style.animationDelay = delay + "ms";
            
            column.addEventListener("animationend", () => {
                column.style.top = "-100%";
                column.style.animationDelay = "0ms";
                column.style.animationDuration = (Math.random() * 8000 + 6000) + "ms";
            });
        }

        function recreateColumns() {
            // 清除所有现有的列
            columns.forEach(col => col.remove());
            columns.length = 0;
            
            // 重新创建所有列
            columnCount = Math.floor(window.innerWidth / columnSpacing);
            for (let i = 0; i < columnCount; i++) {
                createColumn(i);
            }
        }

        function createUserText(text) {
            const userText = document.createElement("div");
            userText.className = "user-text";
            userText.textContent = text + " ❤";
            const randomLeft = Math.random() * (window.innerWidth - 200);
            userText.style.left = randomLeft + "px";
            userText.style.animationDuration = "8000ms";
            matrix.appendChild(userText);
            
            userText.addEventListener("animationend", () => {
                userText.remove();
            });
        }

        textInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter" && textInput.value.trim()) {
                createUserText(textInput.value);
                textInput.value = "";
            }
        });

        // 监听背景文字输入框的变化
        backgroundTextInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter") {
                backgroundText = getBackgroundText();
                recreateColumns();
            }
        });

        backgroundTextInput.addEventListener("blur", () => {
            backgroundText = getBackgroundText();
            recreateColumns();
        });

        for (let i = 0; i < columnCount; i++) {
            createColumn(i);
        }

        window.addEventListener("resize", () => {
            const newColumnCount = Math.floor(window.innerWidth / columnSpacing);
            if (newColumnCount !== columnCount) {
                recreateColumns();
            }
        });
    </script>
</body>
</html>
